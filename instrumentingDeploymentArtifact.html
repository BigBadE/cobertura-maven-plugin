<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-05-23
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="James Carpenter" />
    <meta name="Date-Creation-yyyymmdd" content="20090901" />
    <meta name="Date-Revision-yyyymmdd" content="20150523" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Mojo's Maven plugin for Cobertura &#x2013; Instrumenting Deployment Artifact</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../" id="bannerLeft">
                                                                                                <img src="../images/mojo_logo.png"  alt="Mojo"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://codehaus.org/" id="bannerRight">
                                                                                                <img src="../images/codehaus-small.png"  alt="Codehaus"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://codehaus.org/" class="externalLink" title="Codehaus">
        Codehaus</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../" title="Mojo">
        Mojo</a>
        </li>
      <li class="divider ">/</li>
                <li class="">
                    <a href="./" title="Mojo's Maven plugin for Cobertura">
        Mojo's Maven plugin for Cobertura</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Instrumenting Deployment Artifact</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2015-05-23</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 2.7</li>
            
                                            <li class="divider pull-right">|</li>
                        
    <li class="pull-right">              <a href="http://cobertura.sourceforge.net/" class="externalLink" title="Cobertura">
        Cobertura</a>
  </li>

        <li class="divider pull-right">|</li>
      
    <li class="pull-right">              <a href="http://maven.apache.org/" class="externalLink" title="Maven">
        Maven</a>
  </li>

                        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="plugin-info.html" title="Goals">
          <i class="none"></i>
        Goals</a>
            </li>
                  
      <li>
    
                          <a href="usage.html" title="Usage">
          <i class="none"></i>
        Usage</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Instrumenting a Deployment Artifact</a>
          </li>
                              <li class="nav-header">Examples</li>
                                
      <li>
    
                          <a href="examples/report-formats.html" title="Report Formats">
          <i class="none"></i>
        Report Formats</a>
            </li>
                  
      <li>
    
                          <a href="sample-maven-shared-io-report/index.html" title="Sample Cobertura Report">
          <i class="none"></i>
        Sample Cobertura Report</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="mojo.codehaus.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- ~ --><!-- #%L --><!-- Mojo's Maven plugin for Cobertura --><!-- %% --><!-- Copyright (C) 2005 - 2013 Codehaus --><!-- %% --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!-- #L% --><!-- ~ --><div class="section">
<h2><a name="Overview"></a>Overview</h2>
<p>It is occasionally useful to measure the code coverage for manual and/or automated tests which run against a test environment. (Not to be confused with measuring code coverage of unit tests executed automatically by the build system.) For example, you may have a set of automated regression tests written using JMeter, Selenium, etc. which for some reason or another are not appropriate to run as part of the maven build.</p>
<p>To accomplish this the following high level steps are required.</p>
<ol style="list-style-type: decimal">
<li>Create the deployment artifact (typically a WAR file) using Cobertura instrumented classes.</li>
<li>Install the deployment artifact within an appropriate test environment.</li>
<li>Execute a relevant set of tests which leverage the deployed code.</li>
<li>Collect and merge the cobertura ser file(s) and generate a coverage report.</li></ol>
<div class="section">
<h3><a name="Technical_Considerations"></a>Technical Considerations</h3>
<p>Measuring coverage for a build artifact deployed within a test infrastructure differs in several meaningful ways from the more common scenario which focus on unit test coverage. An awareness of these differences makes it much easier to understand the nitty-gritty Maven details which follow.</p>
<ul>
<li>Execution of the tests happens outside of a Maven environment. In many cases Maven is simply the wrong tool for executing these sorts of tests.</li>
<li>To generate a coverage report will require the cobertura ser file associated with each jar in the deployment artifact to be merged with the cobertura file created when the deployment artifact is run.
<p>The cobertura ser file produced when the classes within a given jar are instrumented record the number of executable lines within the jar along with various other meta-data. The cobertura ser file created (or modifications thereof) when the deployment artifact is executed only records information related to the lines of code which were executed. Consequently, a coverage report created using only the cobertura ser created by the execution of the deployment artifact will falsely report 100% coverage.</p>
<p>This can take a few seconds to wrap your mind around. The trick is to understand that since the cobertura ser file created by the deployment artifact only records lines which were executed, a report based on such a ser file observes that 100% of what the ser file knows about has been covered.</p></li>
<li>To generate a coverage report will require the source code corresponding to every jar of interest within the deployment artifact. The source used should line up exactly with that used to create the jars. The most recent source code from source control won't do. The easiest way to obtain source code which correlates with an instrumented classes jar artifact is simply to ensure the maven source plugin creates a source jar as an attached artifact to the instrumented classes jar.</li></ul></div></div>
<div class="section">
<h2><a name="Maven_Configuration_Details"></a>Maven Configuration Details</h2>
<div class="section">
<h3><a name="Overview"></a>Overview </h3>
<p>The approach shown here addresses the technical considerations discussed in the overview section. Several key aspects of the maven configuration are listed below.</p>
<ul>
<li>Each child of a multi-module project which contains java code provides the cobertura.ser and sources jar as attached artifacts whenever the relevant profile is engaged.</li>
<li>Each child of a multi-module project which contains java code includes the cobertura-runtime as a &quot;provided&quot; scope dependency whenever the relevant profile is engaged. (The use of provided scope assumes the container into which the deployment artifact is deployed will provide the cobertura jar. If this is not the case you may need to use compile scope.)</li>
<li>An additional cobertura focused child module is introduced to the multi-module build. This child uses the assembly plugin to create an archive which collects all the necessary files needed to generate a coverage report and registers it as an attached artifact. The assembled archive will include sources and cobertura.ser files from each sibling, along with a short ant script capable of building a coverage report for the deployment artifact.</li>
<li>Assuming the deployment artifact is deployed within a web container the container must be configured to provide the cobertura jar. In the case of Tomcat you simply drop the cobertura jar in Tomcat's common/lib directory. You should also ensure all the runtime dependencies of the cobertura jar are available, but as it turns out at the time of writing there are not any. (See the cobertura-runtime artifact's POM for runtime dependency details.)</li>
<li>Assuming the deployment artifact is deployed within a web container the coberturaFlush.war should be installed as well. Every time the coberturaFlush/flushCobertura URL is accessed, the cobertura.ser file used by the deployment artifact will updated. The coberturaFlush.war can be found in newer Cobertura binary releases. It doesn't currently appear in the maven repository. If the coberturaFlush.war is not used the cobertura.ser file will only be written when the container is shutdown and then only if the container shuts down cleanly such that the shutdown hooks run properly. See <a class="externalLink" href="http://cobertura.sourceforge.net/faq.html">http://cobertura.sourceforge.net/faq.html</a> for details.
<p>For the coberturaFlush WAR to work correctly, it must load cobertura using the same classloader the deployment artifact being measured is using. This is why the cobertura jar is listed at provided scope within Maven. By using provided scope the cobertura jar is excluded from the deployment artifact (WAR file), with the deployed code relying upon the web container to provide it. In the case of Tomcat common/lib is used rather than shared/lib since cobertura must be loaded by a classloader common to the coberturaFlush WAR and the WAR being measured.</p></li></ul></div>
<div class="section">
<h3><a name="Relevant_Enhancements_to_the_Parent_POM"></a>Relevant Enhancements to the Parent POM</h3>
<p>The parent pom should set up the cobertura:instrument and source:jar goals. Notice the instrument goal has been configured with a true attach value.</p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
 xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.mycompany.someproject&lt;/groupId&gt;
  &lt;artifactId&gt;SomeProject-parent&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;name&gt;SomeProject Parent&lt;/name&gt;
  &lt;modules&gt;
    &lt;module&gt;SomeProject-libA&lt;/module&gt;
    &lt;module&gt;SomeProject-libB&lt;/module&gt;
    &lt;module&gt;SomeProject-webapp&lt;/module&gt;
  &lt;/modules&gt;
  &lt;build&gt;
    ...
    &lt;pluginManagement&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
          &lt;artifactId&gt;cobertura-maven-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.4&lt;/version&gt;
        &lt;/plugin&gt;
        ...
      &lt;/plugins&gt;
    &lt;/pluginManagement&gt;
  &lt;/build&gt;
  &lt;properties&gt;
    &lt;cobertura.version&gt;1.9.2&lt;/cobertura.version&gt;
    ...
  &lt;/properties&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;cobertura-instrument&lt;/id&gt;
      &lt;activation&gt;
        &lt;property&gt;
          &lt;name&gt;cobertura-build&lt;/name&gt;
        &lt;/property&gt;
      &lt;/activation&gt;
      &lt;modules&gt;
        &lt;module&gt;SomeProject-cobertura&lt;/module&gt;
      &lt;/modules&gt;
      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
            &lt;artifactId&gt;cobertura-maven-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;instrument-code&lt;/id&gt;
                &lt;phase&gt;process-classes&lt;/phase&gt;
                &lt;goals&gt;
                  &lt;goal&gt;instrument&lt;/goal&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                  &lt;attach&gt;true&lt;/attach&gt;
                &lt;/configuration&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
          &lt;plugin&gt;
            &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;attach-sources&lt;/id&gt;
                &lt;goals&gt;
                  &lt;goal&gt;jar&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
            &lt;inherited&gt;true&lt;/inherited&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;net.sourceforge.cobertura&lt;/groupId&gt;
          &lt;artifactId&gt;cobertura-runtime&lt;/artifactId&gt;
          &lt;version&gt;${cobertura.version}&lt;/version&gt;
          &lt;scope&gt;provided&lt;/scope&gt;
          &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/profile&gt;
    ...
  &lt;/profiles&gt;
&lt;/project&gt;</pre></div></div>
<div class="section">
<h3><a name="Changes_to_Typical_Child_POM"></a>Changes to Typical Child POM</h3>
<p>In most cases the child POMs will remain untouched. All the necessary changes will be inherited from the parent pom. This is true for both jar and war packaging types.</p>
<p>Even if the cobertura:instrument goal is configured to include a module's cobertura.ser file as an attached artifact, it will gracefully skip doing so if no cobertura.ser file was produced. This feature makes it much easier to avoid additional cobertura specific clutter in a typical child POM.</p></div>
<div class="section">
<h3><a name="Contents_of_Cobertura_Specific_Child_POM"></a>Contents of Cobertura Specific Child POM</h3>
<p>As discussed above the cobertura specific child module will assemble all the files necessary to generate a coverage report for the deployed artifact. This assembly will be registered as an attached artifact and therefore be co-deployed with all the other build artifacts.</p>
<p>The following example files should help you to quickly produce an appropriate cobertura focused child module.</p>
<div class="section">
<h4><a name="SomeProject-cobertura_POM_file"></a>SomeProject-cobertura POM file</h4>
<p>This is an example POM file for the cobertura focused child module. Following the example it would be located at SomeProject-cobertura/pom.xml</p>
<div class="source">
<pre>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
  &lt;parent&gt;
    &lt;groupId&gt;com.mycompany.someproject&lt;/groupId&gt;
    &lt;artifactId&gt;SomeProject-parent&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;artifactId&gt;SomeProject-cobertura&lt;/artifactId&gt;
  &lt;name&gt;SomeProject Cobertura&lt;/name&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;descriptors&gt;
            &lt;descriptor&gt;${basedir}/src/main/assembly/coberturaReporting.xml&lt;/descriptor&gt;
          &lt;/descriptors&gt;
          &lt;attach&gt;true&lt;/attach&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;bundle-configs&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;single&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;net.sourceforge.cobertura&lt;/groupId&gt;
      &lt;artifactId&gt;cobertura&lt;/artifactId&gt;
      &lt;!--cobertura.version is inherited from the parent POM--&gt;
      &lt;version&gt;${cobertura.version}&lt;/version&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;SomeProject-webapp&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;classifier&gt;sources&lt;/classifier&gt;
      &lt;type&gt;jar&lt;/type&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;SomeProject-webapp&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;classifier&gt;cobertura&lt;/classifier&gt;
      &lt;type&gt;ser&lt;/type&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;SomeProject-libA&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;classifier&gt;sources&lt;/classifier&gt;
      &lt;type&gt;jar&lt;/type&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;SomeProject-libA&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;classifier&gt;cobertura&lt;/classifier&gt;
      &lt;type&gt;ser&lt;/type&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;SomeProject-libB&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;classifier&gt;sources&lt;/classifier&gt;
      &lt;type&gt;jar&lt;/type&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;SomeProject-libB&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;classifier&gt;cobertura&lt;/classifier&gt;
      &lt;type&gt;ser&lt;/type&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;</pre></div></div>
<div class="section">
<h4><a name="Assembly_Descriptor"></a>Assembly Descriptor</h4>
<p>This assembly descriptor will typically be found at src/main/assembly/coberturaReporting.xml within the cobertura focused child module.</p>
<div class="source">
<pre>&lt;assembly&gt;
  &lt;!--id is used for classifier in attached artifact--&gt;
  &lt;id&gt;coberturaReporting&lt;/id&gt;
  &lt;formats&gt;
    &lt;format&gt;tar.gz&lt;/format&gt;
    &lt;!--format&gt;dir&lt;/format--&gt;
  &lt;/formats&gt;
  &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
  &lt;files&gt;
    &lt;file&gt;
      &lt;source&gt;${basedir}/src/main/coberturaScripts/cobertura.xml&lt;/source&gt;
      &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
      &lt;filtered&gt;false&lt;/filtered&gt;
    &lt;/file&gt;
    &lt;file&gt;
      &lt;source&gt;${basedir}/src/main/coberturaScripts/cobertura.properties&lt;/source&gt;
      &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
      &lt;filtered&gt;true&lt;/filtered&gt;
    &lt;/file&gt;
  &lt;/files&gt;
  &lt;dependencySets&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;false&lt;/unpack&gt;
      &lt;outputDirectory&gt;/antjars&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;net.sourceforge.cobertura:cobertura&lt;/include&gt;
      &lt;/includes&gt;
      &lt;useTransitiveDependencies&gt;true&lt;/useTransitiveDependencies&gt;
      &lt;useTransitiveFiltering&gt;true&lt;/useTransitiveFiltering&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;true&lt;/unpack&gt;
      &lt;outputDirectory&gt;/sources/SomeProject-webapp&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.someproject:SomeProject-webapp:jar:sources&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;true&lt;/unpack&gt;
      &lt;outputDirectory&gt;/sources/SomeProject-libA&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.someproject:SomeProject-libA:jar:sources&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;true&lt;/unpack&gt;
      &lt;outputDirectory&gt;/sources/SomeProject-libB&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.someproject:SomeProject-libB:jar:sources&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;false&lt;/unpack&gt;
      &lt;outputDirectory&gt;/cobertura&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.someproject:SomeProject-webapp:ser:cobertura&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;false&lt;/unpack&gt;
      &lt;outputDirectory&gt;/cobertura&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.someproject:SomeProject-libA:ser:cobertura&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;unpack&gt;false&lt;/unpack&gt;
      &lt;outputDirectory&gt;/cobertura&lt;/outputDirectory&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.someproject:SomeProject-libB:ser:cobertura&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
  &lt;/dependencySets&gt;
&lt;/assembly&gt;</pre></div></div>
<div class="section">
<h4><a name="Cobertura_Ant_Script_Included_in_Assembly"></a>Cobertura Ant Script Included in Assembly</h4>
<p>This ant script will typically be found at src/main/coberturaScripts/cobertura.xml within the cobertura focused child module.</p>
<p>This ant script uses the cobertura-merge ant task to merge the cobertura.ser files (including the one produced by the deployed artifact), and then uses the the cobertura-report ant task to generate an html report.</p>
<p>Although the script happens to be an ant script, any appropriate scripting tool would work here so long as it can execute the necessary cobertura libraries. It is important to realize, that although the script (as well as the entire reporting bundle) is built by Maven it is not part of the build system. It is simply a release artifact which knows how to build a coverage report for an instrumented deployment artifact.</p>
<div class="source">
<pre>&lt;project&gt;

  &lt;property name=&quot;antjars.dir&quot; value=&quot;${basedir}/antjars/&quot; /&gt;

  &lt;path id=&quot;antjars.classpath&quot;&gt;
    &lt;fileset dir=&quot;${antjars.dir}&quot;&gt;
        &lt;include name=&quot;*.jar&quot; /&gt;
    &lt;/fileset&gt;
  &lt;/path&gt;

  &lt;taskdef classpathref=&quot;antjars.classpath&quot; resource=&quot;tasks.properties&quot; /&gt;

  &lt;target name=&quot;init&quot;&gt;
    &lt;property file=&quot;cobertura.properties&quot;/&gt;
    &lt;property name=&quot;src.dir&quot; location=&quot;${basedir}/sources&quot;/&gt;
    &lt;property name=&quot;cobertura.dir&quot; location=&quot;${basedir}/cobertura&quot;/&gt;
    &lt;property name=&quot;merge.dir&quot; location=&quot;${basedir}/merges&quot;/&gt;
    &lt;property name=&quot;merged.ser&quot; location=&quot;${merge.dir}/cobertura.ser&quot;/&gt;
    &lt;property name=&quot;coveragereport.dir&quot; location=&quot;${basedir}/report&quot;/&gt;
   
    &lt;echoproperties&gt;
      &lt;propertyset&gt;
        &lt;propertyref prefix=&quot;coveragereport&quot;/&gt;
        &lt;propertyref prefix=&quot;cobertura&quot;/&gt;
        &lt;propertyref prefix=&quot;merge&quot;/&gt;
        &lt;propertyref prefix=&quot;src.dir&quot;/&gt;
      &lt;/propertyset&gt;
    &lt;/echoproperties&gt;
  &lt;/target&gt;

  &lt;target name=&quot;create-merged-sers&quot;
          depends=&quot;init&quot;&gt;

    &lt;cobertura-merge datafile=&quot;${merged.ser}&quot;&gt;
      &lt;fileset dir=&quot;${cobertura.dir}&quot;&gt;
        &lt;include name=&quot;*-cobertura.ser&quot; /&gt;
      &lt;/fileset&gt;
      &lt;fileset file=&quot;${cobertura.ser.file}&quot;/&gt;
    &lt;/cobertura-merge&gt;
  &lt;/target&gt;

  &lt;target name=&quot;create-report&quot;
          description=&quot;Generate an html coverage report using the contents of the cobertura.ser file.  Performs clean first.&quot;
          depends=&quot;init, clean, create-merged-sers&quot;&gt;
   

   &lt;cobertura-report
     format=&quot;html&quot;
     destdir=&quot;${coveragereport.dir}&quot;
     datafile=&quot;${merged.ser}&quot;&gt;
     &lt;fileset dir=&quot;${src.dir}/SomeProject-webapp&quot;&gt;
        &lt;include name=&quot;**/*.java&quot; /&gt;
     &lt;/fileset&gt;
     &lt;fileset dir=&quot;${src.dir}/SomeProject-libA&quot;&gt;
        &lt;include name=&quot;**/*.java&quot; /&gt;
     &lt;/fileset&gt;
     &lt;fileset dir=&quot;${src.dir}/SomeProject-libB&quot;&gt;
        &lt;include name=&quot;**/*.java&quot; /&gt;
     &lt;/fileset&gt;
   &lt;/cobertura-report&gt;
  &lt;/target&gt;
 
  &lt;target name=&quot;clean-tomcat-data&quot;
          description=&quot;Delete the cobertura.ser file created by tomcat&quot;
          depends=&quot;init&quot;&gt;
    &lt;delete file=&quot;${cobertura.ser.file}&quot;/&gt;
  &lt;/target&gt;
  
  &lt;target name=&quot;clean&quot;
          description=&quot;clean local build artifacts.  Leaves tomcat cobertura.ser file alone.&quot;
          depends=&quot;clean-report, clean-merges&quot;/&gt;
  
  &lt;target name=&quot;clean-report&quot;
          description=&quot;Delete the html reports&quot;
          depends=&quot;init&quot;&gt;
    &lt;delete dir=&quot;${coveragereport.dir}&quot;/&gt;
  &lt;/target&gt;
  
  &lt;target name=&quot;clean-merges&quot;
          description=&quot;Delete the merged cobertura.ser file&quot;
          depends=&quot;init&quot;&gt;
    &lt;delete dir=&quot;${merge.dir}&quot;/&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre></div></div>
<div class="section">
<h4><a name="Cobertura_Ant_Properties_File_Included_in_Assembly"></a>Cobertura Ant Properties File Included in Assembly</h4>
<p>This properties file will typically be found at src/main/coberturaScripts/cobertura.properties within the cobertura focused child module.</p>
<p>The properties here have intentionally been left outside of the cobertura.xml ant script so that the Maven assembly plugin can perform variable substitution if required.</p>
<div class="source">
<pre>#specify location of cobertura.ser file produced by the deployed artifact.
#cobertura.ser.file=${deployment.artifact.workingdir}/cobertura.ser
cobertura.ser.file=/opt/tomcat/bin/cobertura.ser</pre></div></div></div></div>
<div class="section">
<h2><a name="Deployment_and_Report_Generation"></a>Deployment and Report Generation</h2>
<p>Once the necessary Maven build changes described above have been made, you are ready to deploy the deployment artifacts and start making coverage measurements/reports.</p>
<div class="section">
<h3><a name="The_steps_involved_to_use_the_tooling_are_as_follows:"></a>The steps involved to use the tooling are as follows:</h3>
<ol style="list-style-type: decimal">
<li>Run the Maven build with the cobertura-instrument profile engaged. prompt&gt;mvn -Dcobertura-build clean deploy</li>
<li>Deploy the resulting deployment artifact. This typically involves simply copying a WAR file into the webapps directory of a J2EE container such as Tomcat.</li>
<li>Assuming you are deploying to a web container you will need to copy the cobertura-runtime jars into the appropriate location for common file. In the case of Tomcat you will simply copy the cobertura jar to $<a name="CATALINA_BASE">CATALINA_BASE</a>/common/lib.</li>
<li>Assuming you are deploying to a web container you will also need to deploy the coberturaFlush.war into the web container. This war can be found in recent binary distributions of the cobertura project.</li>
<li>Start up the container (Tomcat, etc.).</li>
<li>Exercise the code for which you are measuring coverage. This will occassionally be a few simply manual tests and in others will involve launching some test infrastructure such as JMeter against the deployed infrastructure.</li>
<li>Shutdown the container and ensure the cobertura.ser file is generated when the shutdown hooks fire. By default the cobertura.ser file will be created in the working directory of the container.
<p>Assuming you have deployed to a web container which also has the coberturaFlush.war deployed you can instead call the coberturaFlush/flushCobertura URL to force a flush of cobertura.ser without having to shutdown the web container.</p></li>
<li>Expand the coberturaReporting assembly created by the Maven build in an appropriate work directory.</li>
<li>Ensure the cobertura.ser.file property in the cobertura.properties file correctly points to the cobertura.ser file produced by the deployment artifact. By default this is the working directory of the container. (If I start Tomcat from tomcat/bin the cobertura.ser file shows up in tomcat/bin.)</li>
<li>Run the cobertura.xml ant build.
<p>The relevant ant command to create the report is:</p>
<div class="source">
<pre>&gt;ant -f cobertura.xml create-report</pre></div></li>
<li>Open the report/index.html file created by the ant script within the web browser of your choice and review the results.</li></ol></div></div>
<div class="section">
<h2><a name="Adaptations"></a>Adaptations</h2>
<p>The example above has largely focused on working with WAR deployment artifacts, but the principles remain the same regardless of what type of deployment artifact you are creating. For example in many deployment scenarios you will need to include the cobertura-runtime dependencies in your deployment artifact. As long as you keep the issues listed in the technical considerations section in mind, you should be able to easily work out an acceptable solution.</p></div>
<div class="section">
<h2><a name="Debugging_Hints:"></a>Debugging Hints:</h2>
<ul>
<li>You can determine if an implementation class in your deployment artifact has been instrumented simply by running the javap tool against it. Have javap disassemble a random implementation class and look for the very obvious cobertura calls. (WARNING: Interface classes won't have what your looking for.)
<p>The relevant javap command is:</p>
<div class="source">
<pre>&gt;javap -c SomeImplementationClass</pre></div></li></ul></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2005-2015
                        <a href="http://codehaus.org">Codehaus</a>.
            All Rights Reserved.      
                    
      </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/5211/widgets/project_thin_badge.js"></script>
    </div>
        </div>
    </footer>
  </body>
</html>
